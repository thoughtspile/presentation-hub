<html>

<head>
</head>

<body>
	<script src = '../loader.js'></script>
	<script>
		runGrafar(function() {
			var n = 500,
				frameCount = 60,
				e = new Float32Array(3 * n * n),
				db = new grafar.Database();
			db.constrain({what: 'x', maxlen: n, as: function(data) {
					for (var i = 0; i < n; i++) {
						data.x[i] = i;
					}
				}})
				.constrain({what: 'y', maxlen: n, as: function(data) {
					for (var i = 0; i < n; i++)
						data.y[i] = 100 / (i + 1);
				}});

			console.time(frameCount + 'F');
			var times = [], t = 0;
			(function frame() {
				var s = performance.now();
				db.constrain({what: 'z', using: 'x, y', as: function(data, l, extras) {
					extras.length = l;
					var z = data.z,
						x = data.x,
						y = data.y,
						t1 = t + 1;
					for (var i = 0; i < l; i++)
						z[i] = (Math.sin(x[i]) + y[i]) / t1;
				}});
				var sel = db.select('z').export(['x', 'y', 'z'], e);
				times.push(performance.now() - s);
				t++;
				if (t < frameCount)
					window.requestAnimationFrame(frame);
				else
					finalize();
				//console.log('hellon sel', sel, db, t);
			}());
			function finalize() {
				console.timeEnd(frameCount + 'F');
				var n = times.length,
					meant = times.reduce(function(cumt, t) {
						return cumt + t;
					}, 0) / n,
					stdt = Math.sqrt(times.reduce(function(cumstd, t) {
						return cumstd + Math.pow(t - meant, 2);
					}, 0) / (n - 1)),
					maxdevup = Math.max.apply(null, times.slice(3)) - meant,
					maxdevdown = Math.min.apply(null, times.slice(3)) - meant;
			
				console.log('hello db', db, times, meant, stdt, maxdevup, maxdevdown);
			}
		}, '../')
	</script>
</body>


</html>
