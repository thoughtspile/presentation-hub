<html>

<head>
	<title>Grafar interface test</title>
	
	<style>
		.option {
			border-left: 2pt solid transparent;
			color: #222222;
		}
		.option:hover {
			border-left: 2pt solid orange;
			color: #000;
		}
		.mmvce {
			background: #acc;
			border-radius: 1pt;
		}
	</style>
	
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
			displayAlign: "left"//,
			//"HTML-CSS": { linebreaks: { automatic: true, width: "75% container" } }
		});
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
	<menu id = 'exampleSelect'>
	</menu>

	<script>
		var exampleSelect = document.getElementById('exampleSelect'),
			examples = [
				[
					{type: 'static', text: 'z &=& x^2 + y^2 + y', value: 'z = x^2 + y^2 + y'}, 
					{type: 'range', name: 'x', value: [-2, 2]}, 
					{type: 'range', name: 'y', value: [-1, 3]}
				],
				[
					{type: 'static', text: 'y &=& a \\cdot \\sin x', value: 'y = a * sin(x)'},
					{type: 'static', text: 'x &\\in& [-\\pi, \\pi]', value: 'x @= [-3.14, 3.14]'},
					{type: 'number', name: 'a', value: 0}
				]
			],
			tangles = {};
		
		var mmvcModule = function(example) {
				if (example.type === 'static') {
					this.tex = example.text;
				} else if (example.type === 'range') {
					tangles['editable-min-' + example.name] = example.value[0];
					tangles['editable-max-' + example.name] = example.value[1];
					this.tex = example.name + ' &\\in& [\\class{mmvce}{\\cssId{editable-min-' + example.name + '}{' + example.value[0] + 
						'}},\\class{mmvce}{\\cssId{editable-max-' + example.name + '}{' + example.value[1] + '}}]';
				} else if (example.type === 'number') {
					tangles['editable-val-' + example.name] = example.value;
					this.tex = example.name + ' &=& \\class{mmvce}{\\cssId{editable-val-' + example.name + '}{' + example.value + '}}';
				}
				return this.tex;
			}, 
			toTexSystem = function(lines) {
				return '$$\\left \\{ \\begin{array}{lcl}' + 
					lines.join('\\\\') + 
					'\\end{array} \\right. $$';
			},
			mathMVC = {};
		
		examples.forEach(function(pr) {
			var option = document.createElement('div');
			option.innerHTML = toTexSystem(pr.map(mmvcModule));
			option.className = 'option';
			exampleSelect.appendChild(option);
		});
		
		mathMVC.origin = {x: 0, y: 0};
		mathMVC.coeff = 100;
		mathMVC.target = null;
		mathMVC.mouseDown = false;
		mathMVC.updatePosition = function(event) {
			this.origin.x = event.clientX;
			this.origin.y = event.clientY;
		};
		mathMVC.startDrag = function(event) {
			event.preventDefault();
			var target = event.toElement || event.target;
			while (!/mmvce/.test(target.className))
				target = target.parentNode;
			mathMVC.target = (target.childElementCount === 2? target.lastChild: target);
			mathMVC.updatePosition(event);
			document.addEventListener('mousemove', mathMVC.drag);
		};
		mathMVC.drag = function(event) {
			var val = ((event.clientX - mathMVC.origin.x) + (mathMVC.origin.y - event.clientY))/ mathMVC.coeff;
			mathMVC.updatePosition(event);
			mathMVC.target.innerHTML = (Number(mathMVC.target.innerHTML) + val).toFixed(2);
		};
		mathMVC.drop = function() {
			document.removeEventListener('mousemove', mathMVC.drag);
		};
		
		var bindTangles = function() {
				Object.keys(tangles).forEach(function(id) {
					var field = document.getElementById(id);
					if (field) field.addEventListener('mousedown', mathMVC.startDrag);
				});
			};
		document.onmouseup = mathMVC.drop;
		
		MathJax.Hub.Queue(
			['Typeset', MathJax.Hub],
			[bindTangles]
		);
	</script>
</body>

</html>