<!doctype html>

<html lang="en">
<head>
	<title>Тройные интегралы</title>
	
	<link rel="stylesheet" type="text/css" href="../stylesheets/grafar_style.css" media="screen" />
	
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
			"HTML-CSS": { linebreaks: { automatic: true, width: "75% container" } }
		});
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
	<div id = "plot_area"><!--
		--><div id = "plot3d"></div><!--
		--><div id = "plot2d"></div>
	</div><!--
	--><div id = "ui">
		<h1 id = "logo">grafar jr.</h1>
		
		<div id = "options"></div>
		<div id = "info"></div>
	</div>
	
	<script type="text/javascript" src="problemlist.js"></script>
	<script type="text/javascript" src="../loader.js"></script>
	<script type="text/javascript">
		runGrafar(function() {
			var infoDiv = document.getElementById('info');
			problems.forEach(function(pr) {
				pr.div = document.createElement('div');
				pr.div.innerHTML = pr.info;
			});
			
			var maxHelpers = Math.max.apply(null, problems.map(function(p) {return p.eqns.length;})),
				activeHelpers = 0;
			
			grafar.ui([
				{type: 'label', init: 'Choose the problem: '},
				{type: 'select', id: 'problem', init: problems.map(function(pr) {
						return pr.id + ': ' + pr.eqns.join(' & ');
					}), bind: updateProblem},
				{type: 'br'},
				{type: 'select', id: 'dim', init: ['x', 'y', 'z'], bind: updateSection},
				{type: 'label', init: ' = '},
				{type: 'number', id: 'val', init: 0, bind: updateSection},
				{type: 'br'},
				{type: 'checkbox', id: 'helpers', bind: plotArea},
				{type: 'label', init: 'Show the original shapes'}
				//{type: 'br'},
				//{type: 'label', init: 'n = '},
				//{type: 'number', id: 'n', init: 2, bind: plotArea}
			], {container: 'options'});
			
			var pan3d = new grafar.Panel(document.getElementById('plot3d')),
				pan2d = new grafar.Panel(document.getElementById('plot2d'));
			
			// scaling
			//grafar.panels['3D'].camera.position.set(-3, 3, 3);
			
			var helpers2d = [], 
				helpers3d = [];
			for (var i = 0; i < maxHelpers; i++) {
				helpers2d.push(new grafar.Object().pin(pan2d));
				helpers3d.push(new grafar.Object().pin(pan3d));
			}
			
			var area = new grafar.Object().pin(pan3d),
				section = new grafar.Object().pin(pan3d),//.pin(pan2d);
				section2 = new grafar.Object().pin(pan2d);//.pin(pan2d);
			
			var problem;
			updateProblem();			
			
			function updateProblem() {
				problem = problems[grafar.UI.problem.val];
				
				if (infoDiv.children.length !== 0)
					infoDiv.removeChild(infoDiv.firstChild);
				infoDiv.appendChild(problem.div);
				if (grafar.isExisty(window.MathJax))
					MathJax.Hub.Queue(['Typeset', MathJax.Hub]);
				
				activeHelpers = problem.eqns.length;
				for (var i = 0; i < activeHelpers; i++) {
					helpers3d[i].constrain({what: 'x, y, z', maxlen: 12000, as: grafar.ductParse(problem.eqns[i], problem.cube)}).refresh();
				};
				for ( ; i < maxHelpers; i++) {
					helpers3d[i].hide(true);
					helpers2d[i].hide(true);
				};
				area.constrain({what: 'x, y, z', maxlen: 15000, as: grafar.ductParse(problem.eqns.join('&'), problem.cube)}).refresh();
				
				plotArea();
				updateSection();
			}
			
			function plotArea() {
				for (var i = 0; i < activeHelpers; i++) {
					helpers3d[i].hide(!grafar.UI.helpers.val);
					helpers2d[i].hide(!grafar.UI.helpers.val);
				}
			}
			
			function updateSection() {
				var dim = grafar.UI.dim.val,
					targetvar = ['x', 'y', 'z'][dim],
				    height = grafar.UI.val.val,
					sector = '&' + targetvar + '==' + height;
					
				pan2d.setAxes(grafar.setpop(['x', 'y', 'z'], targetvar));
				section.constrain({what: 'x, y, z', maxlen: 5000, as: grafar.ductParse(problem.eqns.join('&') + sector, problem.cube)}).refresh();
				section2.constrain({what: 'x, y, z', maxlen: 5000, as: grafar.ductParse(problem.eqns.join('&') + sector, problem.cube)}).refresh();
				for (var i = 0; i < activeHelpers; i++)
					helpers2d[i].constrain({what: 'x, y, z', maxlen: 5000, as: grafar.ductParse(problem.eqns[i] + sector, problem.cube)}).refresh();
			}
		}, '../');
	</script>

	</body>
</html>